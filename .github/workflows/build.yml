name: Build

on:
  push:
    branches:
      - '**'
    tags:
      - '**'

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - run: go build
      - if: startsWith(github.ref, 'refs/tags/v')
        run: |
          tar -czvf gcs-cacher_${{ github.ref_name }}_linux_amd64.tgz gcs-cacher
          sha256sum gcs-cacher_${{ github.ref_name }}_linux_amd64.tgz > gcs-cacher_${{ github.ref_name }}_SHA256SUMS
      - if: startsWith(github.ref, 'refs/tags/v')
        uses: actions/upload-artifact@v2
        with:
          name: gcs-cacher_${{ github.ref_name }}_linux_amd64.tgz
          path: ./gcs-cacher_${{ github.ref_name }}_linux_amd64.tgz
      - if: startsWith(github.ref, 'refs/tags/v')
        uses: actions/upload-artifact@v2
        with:
          name: gcs-cacher_${{ github.ref_name }}_SHA256SUMS
          path: ./gcs-cacher_${{ github.ref_name }}_SHA256SUMS

